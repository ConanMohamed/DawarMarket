{% load i18n %}

<title>Order #{{ order.id }}</title>

<style>
    body {
        font-family: 'Cairo', sans-serif;
        direction: rtl;
        background-color: #fff;
        color: #333;
        padding: 40px;
        font-size: 16px;
    }

    h1 {
        font-size: 24px;
        margin-bottom: 10px;
        color: #444;
    }

    .section-title {
        font-size: 20px;
        margin-top: 30px;
        border-bottom: 2px solid #eee;
        padding-bottom: 5px;
        margin-bottom: 15px;
    }

    .info-block {
        margin-bottom: 10px;
    }

    .info-block strong {
        display: inline-block;
        width: 120px;
        font-weight: bold;
        color: #222;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    table th, table td {
        border: 1px solid #ccc;
        padding: 12px;
        text-align: center;
        font-size: 15px;
    }

    table th {
        background-color: #f5f5f5;
        color: #333;
    }

    td {
        color: #333 !important;
        font-weight: 500;
    }

    .table-footer {
        background-color: #007bff !important;
        color: #fff !important;
        font-weight: bold;
        font-size: 16px;
    }

    .print-btn {
        margin-top: 30px;
        padding: 10px 25px;
        font-size: 16px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

    @media print {
        .print-btn {
            display: none;
        }
    
        .sidebar, .main-sidebar, .nav-sidebar, .navbar, .header, .footer {
            display: none !important;
        }
    
        body {
            margin: 0;
            padding: 20px;
        }
    
        .content-wrapper {
            margin: 0 !important;
        }
    }
    
</style>


<p class="section-title">تفاصيل الطلب #{{ order.id }}</p>

<div class="section-title">معلومات العميل</div>
<div class="info-block"><strong>الاسم:</strong> {{ order.customer.full_name }}</div>
<div class="info-block"><strong>الهاتف:</strong> {{ order.customer.phone }}</div>
<div class="info-block"><strong>العنوان:</strong> {{ order.customer.address }}</div>
<div class="info-block"><strong>علامة مميزة:</strong> {{ order.customer.near_mark }}</div>

<div class="section-title">تفاصيل الطلب</div>
<table>
    <thead>
        <tr>
            <th>المنتج</th>
            <th>الكمية</th>
            <th>السعر</th>
            <th>المجموع</th>
        </tr>
    </thead>
    <tbody>
        {% for item in order.items.all %}
        <tr>
            <td>{{ item.product.title }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.product.price_after_discount|floatformat:2 }} EGP</td>
            <td>{{ item.total|floatformat:2 }} EGP</td>
        </tr>
        {% endfor %}
        <tr class="table-footer">
            <td colspan="3" style="text-align: right;">المجموع الكلي:</td>
            <td>{{ order.total_price|floatformat:2 }} EGP</td>
        </tr>
    </tbody>
</table>

<div class="info-block"><strong>الحالة:</strong> {{ order.order_status }}</div>
<div class="info-block"><strong>وقت الطلب:</strong> {{ order.placed_at }}</div>

<button class="print-btn" onclick="window.print()">🖨️ طباعة الطلب</button>


<script>
    document.addEventListener("DOMContentLoaded", function () {
      const rows = document.querySelectorAll("table tbody tr");
      let grandTotal = 0;
  
      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
  
        // تجاهل الصف الأخير اللي فيه الإجمالي
        if (cells.length < 4) return;
  
        const quantityText = cells[1].textContent.trim();
        const priceText = cells[2].textContent.trim();
  
        const quantity = parseFloat(quantityText) || 0;
        const price = parseFloat(priceText.replace(/[^\d.]/g, '')) || 0;
  
        const total = quantity * price;
        cells[3].textContent = `EGP ${total.toFixed(2)}`;
  
        grandTotal += total;
      });
  
      // تحديث الإجمالي الكلي في آخر صف
      const footerTotalCell = document.querySelector(".table-footer td:last-child");
      if (footerTotalCell) {
        footerTotalCell.textContent = `EGP ${grandTotal.toFixed(2)}`;
      }
    });
  </script>
  